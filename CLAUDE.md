## Next.js 15 ベストプラクティス総まとめ

### **プロジェクト構造**

- `app/ components/ lib/` など機能別ディレクトリを切り、巨大フォルダ化や深すぎる入れ子を避ける[1].
- 旧 `pages/` 依存をやめ、App Router 前提の構成に移行する[1].

### **型安全と言語設定**

- TypeScript を標準採用し、コンポーネントや API コールの型を明示する[2].

### **データ取得 & キャッシュ戦略**

- SSG・ISR・SSR・クライアントフェッチをケース別に使い分ける（例：頻繁更新は ISR、静的ページは SSG）[2].
- Next.js 15 では `fetch` が既定で `no-store`。キャッシュしたい場合は `cache:'force-cache'` などを明示する[3].
- ISR の `revalidate` を適切に設定し、動的ページを瞬時に更新する[2].

### **パフォーマンス最適化**

- インクリメンタルコンパイルでビルド時間を短縮し、CI/CD の待ち時間を削減する[4].
- 進化したツリーシェイキング & コードスプリッティングで JS バンドルを小さく保つ[4].
- API レスポンスを `stale-while-revalidate` などでキャッシュし、API 依存ページを高速化する[2].
- 画像は ``に`loading="lazy"` を付け、動的 import・SWR で通信量を抑える[5].

### **モニタリング & 可観測性**

- LCP/FID など Web Vitals を収集し、Google Analytics へ送信して継続的に監視する[2].

### **アクセシビリティ & SEO**

- セマンティック HTML と `aria-*` 属性を徹底し、Lighthouse/Axe で自動テストする[2].
- スキーママークアップやメタタグ最適化で検索順位を向上させる[6].

### **セキュリティ**

- JWT 認証は `middleware.ts` でトークン検証し、保護ルートをガードする[7].
- `next.config.js` で HSTS や `X-Frame-Options` などのヘッダーを設定する[7].

### **本番運用**

- `create-next-app` で TypeScript・Tailwind・App Router を有効化し、`npm run dev / build / start` の３段構成で本番ビルドを管理する[8].
- Vercel 以外へデプロイする場合も、環境変数と CDN 設計を早期に整備してスケーラビリティを確保する[8].

#### よくある落とし穴と回避策

- **“utils.ts ブラックホール”**：巨大化する前に `lib/` 以下へ細分化[1].
- **コンポーネント大渋滞**：`components/` に 200 以上ファイルを置かずサブフォルダで整理[1].
- **深すぎるパス構造**：４階層程度を上限とし可読性を保つ[1].

これらを **claude.md** やチーム Wiki に明文化し、CI で型チェック・Lint・Web Vitals 送信を自動化すれば、Next.js 15 の機能と開発体験を最大限活かせます。

## 推奨ディレクトリ構成（Next.js 15・App Router 前提）

```
my-next-app/
├── public/               # 静的アセット
├── src/                  # アプリケーションコード
│   ├── app/              # ルーティング & Server Components
│   │   ├── layout.tsx
│   │   ├── page.tsx
│   │   ├── (marketing)/  # ルートグループ※URLに含まれない
│   │   └── blog/
│   │       ├── page.tsx
│   │       └── [slug]/
│   │           ├── page.tsx
│   │           └── _actions/  # そのルート専用 Server Action
│   ├── components/       # 共有 UI コンポーネント
│   │   ├── ui/
│   │   └── features/
│   ├── hooks/            # カスタム React Hooks
│   ├── lib/              # 汎用ライブラリ／ユーティリティ
│   ├── styles/           # グローバル CSS / Tailwind
│   ├── types/            # 型定義
│   └── context/          # React Context
├── .env*                 # 環境変数
├── next.config.js
└── package.json
```

この形は公式ドキュメントと複数のコミュニティ記事で紹介されている「src 配下に app・components・lib などをまとめる」パターンで、スケールしやすく保守しやすいと評価されています[1][2][3].

### 各フォルダのポイント

- **app/**  
  ルート階層ごとにフォルダ＝ URL が対応。`(marketing)` のような括弧付きフォルダは「ルートグループ」として URL には現れません[3]。  
  ルート固有のデータ取得・Server Action は `_actions/` や `_data/` などアンダースコア付きフォルダに入れるとルーターから除外でき、見通しも良くなります[4][3].

- **components/**  
  UI コンポーネントを `ui/`（純粋 UI）と `features/`（画面固有）に分けると肥大化を防げます[2].

- **lib/** / **utils/**  
  API クライアントや共通ロジックを配置。命名はどちらでも良いが、プロジェクト内で統一すると検索性が上がります[1][4].

- **hooks/**  
  カスタムフックはここに集約し、ファイル名は `useXxx.ts` と動詞で始める慣例が一般的です[2][5].

- **styles/**  
  Tailwind や CSS Modules などのグローバルスタイルを置く。コンポーネント単位の `.module.css` は同じフォルダにコロケーションして可読性を高めます[5].

### ルーティング関連の特殊フォルダ

| 記法      | 目的                                 | 例                          |
| --------- | ------------------------------------ | --------------------------- |
| `_folder` | ルーティング対象外のプライベート実装 | `_actions/`, `_helpers/`[3] |
| `(group)` | URL に含めずにルートを整理           | `(dashboard)/settings`[3]   |

### フォルダ構成ベストプラクティス

- **浅い階層を保つ**  
  深いネストは可読性と移動コストを下げるので避ける[1][5].
- **コロケーションを活用**  
  ルートやコンポーネントに密接なファイルは同じフォルダに置き、import パスを短縮[3].
- **判別しやすい名前**  
  `btn.tsx` ではなく `Button.tsx` のように機能を明示[5].
- **index.ts / index.tsx で再エクスポート**  
  `components/ui/index.ts` でバレルを作り import 行を簡潔に[1].
- **Server Action の配置**  
  共有するものは `src/server/actions/`、ルート専用ならそのルート配下の `_actions/` に置くと衝突を防げる[4].

これらの指針をチームで合意して `claude.md` や Wiki に明文化し、PR テンプレートでフォルダ追加時のチェックリストを運用すると長期的な健全性を保てます。
